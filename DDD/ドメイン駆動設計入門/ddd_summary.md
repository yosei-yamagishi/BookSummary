# ドメイン駆動設計入門
## 1.1
* ソフトウェア開発におけるドメインは、「プログラムを適用する対象となる領域」
* 重要なのはドメインがなにかではなく、ドメインに含まれるものは何か

## 1.2.1
* モデルとは現実の事象あるいは概念を抽象化した概念
* 必要に応じて取捨選択を行い、何を取捨選択するかはドメインによる
* 事象、あるいは概念を抽象化する作業がモデリング
* DDDでは、ドメインの概念をモデリングして得られたモデルをドメインモデルと呼ぶ

## 1.2.2
* ドメインモデルは何かしらの媒体で表現されることで、問題解決の力を得ます。
* ドメインモデルをソフトウェアで動作するモジュールとして表現したものがドメインオブジェクト
* ドメインの概念 ⇔ ドメインモデル ⇔ ドメインオブジェクト

## 1.4
本書で学ぶDDDのパターン
* 知識を表現するパターン
   * 値オブジェクト
   * エンティティ
   * ドメインサービス
* アプリケーションを実現するためのパターン
   * リポジトリ
   * アプリケーションサービス
   * ファクトリ
* 知識を表現する、より発展的なパターン
   * 集約
   * 仕様

## 2 値オブジェクト[a]
## 2.1
* システム固有の値を表現するために定義されたオブジェクトが値オブジェクト
* システムに最適な値が必ずしもプリミティブな値であるとは限らない( 例は名字と名前 )
* DDDではシステム固有の値を表したオブジェクトを値オブジェクトと呼ぶ
## 2.2
値が持つ性質
* 不変である
* 交換が可能である
* 等価性によって比較される

## 2.2.1
不変である
* 値は不変であるため、値自身を変更するようなメソッドは持っていない。よって値オブジェクトも同様に値オブジェクト内の値を変更するようなメソッドは定義されるべきものではない
* 不変にするデメリットは、オブジェクトの一部を変更したい場合でも、新たなインスタンスを作成する必要がある点

## 2.2.2
交換が可能である
* 値オブジェクトの変更は値と同じ用に代入操作によって交換をすることで表現される
* 代入操作による交換以外の手段で変更を表現できない

## 2.2.3
等価性によって比較される
* システム固有の値である値オブジェクトも値と同様に、値オブジェクトを構成する属性(インスタンス変数)によって比較されます。
* 値と同じように値オブジェクト同士が比較できるようにする方が自然な記述になり、そのためには比較するためのメソッドを提供する必要がある。
[b]

## 2.3
値オブジェクトにする基準
* ドメインモデルとして挙げられていなかった概念を値オブジェクトにすべきかどうかの判断として、「そこにルールが存在しているか」という点と「それ単体で取り扱いたいか」という点を重要視している
* 値オブジェクトにすべきかどうがを見極めて、そうするべきと判断したのであれば大胆に行動すべき
* 値オブジェクトとして定義するほどの価値がある概念を実装中に発見したのであれば、それはドメインモデルとしてフィードバックするべき


## 2.4
ふるまいをもった値オブジェクト
* 値オブジェクト自身でふるまいを持つこともできる
(ふるまいとは、値オブジェクトのプロパティを変更するのではなくあくまでも、値オブジェクトで定義されたfuncに引数を渡して、値オブジェクトのプロパティを用いて計算して、オブジェクトや値を返却するようなこと)
* 値オブジェクトは決してただのデータ構造体のことを指しているのではない。
* オブジェクトに対する操作を振るまいとして一処にまとめることで、値オブジェクトは自身に関するルールを語るドメインオブジェクトらしさを帯びる


## 2.4.1
定義されないからこそわかること
* オブジェクトに定義されるふるまいは、そのオブジェクトができることを示す。
* オブジェクトに定義されていないふるまいは、そのオブジェクトができないこと


## 2.5
値オブジェクトを採用するモチベーション
* 表現力を増す
* 不正な値を存在させない
* 誤った代入を防ぐ
* ロジックの散財を防ぐ


## 2.5.1
表現力を増す
* 値オブジェクトはその定義により自分がどういったものであるかを主張する自己文書化を推し進めます。

## 2.5.2
不正な値を存在させない
* 値オブジェクトを作成する際に、ルールを適用させるとルールに従っていない不正な値は存在しなくなる

## 2.5.3
誤っった代入を防ぐ
* 値オブジェクトを利用することで、間違った代入を防ぐことができる。
* もし間違った値を代入してしまっても、コンパイラが事前にエラーを検出して知らせてくれる
* 値オブジェクトを使って可能な限りエラーを未然に防ぐことが大事

## 2.5.4
ロジックの散財を防ぐ
* 値オブジェクトにルールをまとめることでルールがあちこち散らばった状態になって変更する箇所が増えて、修正漏れを防ぐことができる
* ルールをまとめるということは変更箇所をまとめることと同義です。
* ソフトフェアが変更を受け入れることができる柔軟さを確保するためには、このまとめる作業こそが重要なのです。

## 2.6
まとめ
* 値オブジェクトのコンセプトは「システム固有の値を作ろう」という単純なもの
* プリミティブ型は汎用的過ぎて、どうしても表現力が乏しくなる
* 値オブジェクトはドメインの知識をコードへ落とし込むドメイン駆動設計における基本のパターン
* ドメインの概念をオブジェクトとして定義しようとするときに、まずは値オブジェクトにあてはめて見ることを検討する

## 3.1
エンティティとは
* ドメイン駆動設計におけるエンティティはドメインモデルを実装したドメインオブジェクト
* 値オブジェクトとエンティティの違いは、同一性によって識別されるかどうか

## 3.2
* エンティティは属性ではなく同一性によって識別されるオブジェクト

エンティティの性質
* 可変である
* 同じ属性であっても区別される
* 同一性により区別される

## 3.2.1
可変である
* 値オブジェクトは不変なオブジェクト、エンティティは可変なオブジェクト
* エンティティは交換により変更を行いません。エンティティの属性を変化させたいときは、その振る舞いを通じて属性を変更することになる

## 3.2.2
同じ属性であっても区別される
* 値オブジェクトは同じ属性であれば同じものとして扱われた。
* エンティティは、たとえ同じ属性であっても区別される
* 人間と同様にシステム上の利用者であるユーザーも、等価性ではなく同一性によって識別される必要がある
* 識別子(ID)を定義することで区別される

## 3.2.3
同一性をもつ
* オブジェクトには属性が異なっていたとしても同じものとしてみなす必要があるものが存在し、それらは皆同一性により識別されるオブジェクト
* 同一性の判断を実現するために識別子を利用する
* エンティティの比較処理では同一性を表す識別子(id)だけが比較対象となる

## 3.3
エンティティの判断基準としてのライフサイクルと連続性

* 値オブジェクトとエンティティの判断基準はライフサイクル
* ライフサイクルとは、作成や変更や削除が連続的に行われること
* ライフサイクルをもち、連続性のある概念ではエンティティにする
* ライフサイクルをもたない、システムにとってライフサイクルを表現することが無意味な場合は、ひとまず値オブジェクト

## 3.4
値オブジェクトとエンティティのどちらにもなりうるモデル
* 同じものを題材にしても、取り巻く環境によってモデルに対する捉え方は変わる
* 値オブジェクトもエンティティになり得る概念があることを認識する必要がある

## 3.5
ドメインオブジェクトを定義するメリット

* コードのドキュメント性が高まる
* ドメインにおける変更をコードに伝えやすくなる

## 3.5.1
コードのドキュメント性が高まる
* ドメインモデルに渦巻くルールはそのままドメインオブジェクトに記述されることになり、ドメインオブジェクトの正当性を担保することに役立つ

## 3.5.2
ドメインにおける変更をコードに伝えやすくする
* ドメインオブジェクトにルールやふるまいを記述することは、ドメインからドメインモデルへ伝搬した変化をドメインオブジェクトまで到達させるために必要なこと

## まとめ
エンティティを実装しようとしてそこに曖昧さを感じたら、ドメインの捉え方を見つめ直すきっかけ

## 4
## 4.1
サービスが指し示すもの
* ソフトウェア開発の文脈のサービスは、クライアントのために何かを行うオブジェクト

DDDのサービスは2つ
* ドメインサービス(ドメインのためのサービス)
* アプリケーションサービス(アプリケーションのためのサービス)

## 4.2
ドメインサービスとは
* システムには値オブジェクトやエンティティに記述すると不自然になってしまうふるまいが存在
* ドメインサービスは上記のような不自然さを解決するオブジェクト

## 4.2.1
不自然なふるまいを確認する
* 重複確認はエンティティであるユーザオブジェクトに記述うすると不自然になるふるまいの典型

## 4.2.2
不自然さを解決するオブジェクト
* ドメインサービスは通常のオブジェクトと何ら変わりはない
* ドメインサービスは値オブジェクトやエンティティと異なり、自身の振る舞いを変更するようなインスタンス特有の状態を持たないオブジェクト
* 値オブジェクトやエンティティに定義すると不自然に感じる操作はドメインサービスに定義することで、そこに存在する不自然さは解消される

## 4.3
ドメインサービスの濫用が行き着く先
* ドメインサービスにすべてのふるまいをかけてしまうので「不自然なふるまい」に限定すること
* 無思慮にドメインサービスへふるまいを移設することは、ドメインオブジェクトをただデータを保持するだけの無口なオブジェクトに変容させる結果を招く
* 語るべきことをなにも語っていないドメインオブジェクトの状態をドメインモデル貧血症という

## 4.3.1
可能な限りドメインサービスを避ける
* 定義場所に迷ったらまずはエンティティや値オブジェクトに定義する。可能な限りドメインサービスは利用しない

## 4.4
エンティティや値オブジェクトとともにユースケースを組み立てる

## 4.4.1, 4.4.2
※ユーザー作成をユースケースとした説明

補足
ドメインサービスはドメインモデルのコード上の表現で値オブジェクトやエンティティと同一です。そのためドメインサービスは入出力を伴う処理を取り扱わない用にするべきという考え方もある
しかし「ユーザの重複」という考えがドメインに基づくものであれば、それを実現するサービスはドメインサービスである
可能な限り入出力はドメインサービスで取り扱わない用にするという方針だが、それを考慮した上で、必要とあらば入出力の伴う操作をドメインサービスとすることもいといません。

## 4.5
物流システムに見るドメインサービスの例

## 4.5.1, 4.5.2
※物流システムをユースケースとした説明

コラム
ドメインサービスの命名規則
* ドメインの概念
* ドメインの概念 + Service → 筆者はこれを採用
* ドメインの概念 + DomainService 

## 4.6
まとめ
* ドメインにはドメインオブジェクトに実装すると不自然なふるまいが存在し、複数のドメインの部ジェクトを横断するような操作に多く見られる。そんなとき活用するのがサービスと呼ばれるオブジェクト
* サービスを便利に使いすぎてドメインモデル貧血症をおこさないようにすること

## 5
リポジトリ
